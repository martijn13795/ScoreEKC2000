<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/iron-form-element-behavior/iron-form-element-behavior.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">


<dom-module id="make-match">
    <template>
        <style>
            :host {
                display: block;

                --paper-button-flat-keyboard-focus: {
                    font-weight: normal;
                };
            }

            .container {
                display: flex;
                flex-direction: column;
                flex-wrap: nowrap;
                justify-content: space-between;
                margin: 20px auto;
                max-width: 800px;
            }

            #submit {
                background-color: #373b50;
                color: #fff;
                box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
            }

            .vertical-section:not([style-scope]):not(.style-scope) {
                background-color: white;
                padding: 7px 24px 24px 24px;
                margin: 0 24px 24px 24px;
                box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
            }
        </style>
        <div class="container">
            <div class="vertical center-justified layout">
                <div class="vertical-section">
                    <paper-input id="homeNameInput" label="Thuis" value="{{homeName}}" required auto-validate
                                 error-message="Vul een teamnaam in"></paper-input>
                    <paper-input id="guestNameInput" label="Gasten" value="{{guestName}}" required auto-validate
                                 error-message="Vul een teamnaam in"></paper-input><br>
                    <label id="label1">Speelt EKC 2000 thuis of uit:</label><br>
                    <paper-radio-group selected="{{homeOrGuest}}" aria-labelledby="label1">
                        <paper-radio-button name="home">Thuis</paper-radio-button>
                        <paper-radio-button name="guest">Uit</paper-radio-button>
                    </paper-radio-group>
                    <paper-dropdown-menu name="team" class="dropdown" style="width: 100%;" id="team" label="Selecteer uit welk team de spelers komen" required auto-validate error-message="Selecteer een team" horizontal-align="left" disabled>
                        <paper-listbox slot="dropdown-content" class="dropdown-content" selected="0">
                            <paper-item style="display:none"></paper-item>
                            <paper-item>1</paper-item>
                            <paper-item>2</paper-item>
                            <paper-item>A1</paper-item>
                            <paper-item>B1</paper-item>
                            <paper-item>C1</paper-item>
                        </paper-listbox>
                    </paper-dropdown-menu>
                    <paper-input id="timeMatchInput" label="Minuten per helft" value="{{timeMatch}}" type="number" required auto-validate
                                 error-message="Vul het aantal minuten van &eacute;&eacute;n helft in"></paper-input>
                    <br>
                    <paper-button id="submit" on-click="_submit">Start scoreboard</paper-button>
                </div>
            </div>
        </div>
    </template>

    <script>
        class MakeMatch extends Polymer.Element {
            static get is() {
                return 'make-match';
            }

            static get properties() {
                return {
                    prop1: {
                        type: String,
                        value: 'make-match',
                    },
                    homeName: {
                        type: String,
                    },
                    guestName: {
                        type: String,
                    },
                    homeOrGuest: {
                        type: String,
                        value: 'home',
                    },
                    timeMatch: {
                        type: Number,
                        value: 30,
                    },
                };
            }

            _submit() {
                this.$.homeNameInput.validate();
                this.$.guestNameInput.validate();
                this.$.timeMatchInput.validate();
                if (this.homeName !== undefined && this.homeName !== '' &&
                    this.guestName !== undefined && this.guestName !== ''
                    && this.timeMatch > 0) {
                    let name = this.homeName + ' - ' + this.guestName;
                    let minutes = this.timeMatch.toString();
                    if (minutes < 10) {
                        minutes = '0' + minutes;
                    }

                    database.collection('matches').add({
                        name: name.toString(),
                        homeName: this.homeName.toString(),
                        guestName: this.guestName.toString(),
                        homeScore: 0,
                        guestScore: 0,
                        homeOrGuest: this.homeOrGuest,
                        half: '1',
                        time: this.timeMatch.toString(),
                        timeMinutes: minutes,
                        timeSeconds: '00',
                        date: new Date(),
                        endDate: '',
                    }).then(function(querySnapshot) {
                        console.log('Match made');
                        window.location.href = 'http://ekc2000.nl/includes/activateScoreboard.php' +
                            '?scoreboard=true&scoreboardID=' + querySnapshot.id;
                    }).catch(function(error) {
                        console.error('Error adding document: ', error);
                    });
                }
            }
        }

        window.customElements.define(MakeMatch.is, MakeMatch);
    </script>
</dom-module>
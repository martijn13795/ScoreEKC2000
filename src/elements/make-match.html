<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">


<dom-module id="make-match">
    <template>
        <style>
            :host {
                display: block;
            }

            .container {
                display: flex;
                flex-direction: column;
                flex-wrap: nowrap;
                justify-content: space-between;
                margin: 20px auto;
                max-width: 800px;
            }

            #submit {
                background-color: #373b50;
                color: #fff;
                box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
            }

            .vertical-section:not([style-scope]):not(.style-scope) {
                background-color: white;
                padding: 7px 24px 24px 24px;
                margin: 0 24px 24px 24px;
                box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
            }
        </style>
        <div class="container">
            <div class="vertical center-justified layout">
                <div class="vertical-section">
                    <paper-input label="Thuis" value="{{homeName}}" required auto-validate
                                 error-message="needs some text!"></paper-input>
                    <paper-input label="Gasten" value="{{guestName}}" required auto-validate
                                 error-message="needs some text!"></paper-input>
                    <paper-input label="Minuten per helft" value="{{timeMatch}}" type="number"></paper-input>
                    <br>
                    <paper-button id="submit" on-click="_submit">Start scoreboard</paper-button>
                </div>
            </div>
        </div>
    </template>

    <script>
        class MakeMatch extends Polymer.Element {
            static get is() {
                return 'make-match';
            }

            static get properties() {
                return {
                    prop1: {
                        type: String,
                        value: 'make-match',
                    },
                    homeName: {
                        type: String,
                    },
                    guestName: {
                        type: String,
                    },
                    timeMatch: {
                        type: Number,
                        value: 30,
                    },
                };
            }

            _submit() {
                if (this.homeName != '' && this.guestName != '' && this.timeMatch > 0) {
                    let name = this.homeName + ' - ' + this.guestName;

                    database.collection('matches').add({
                        name: name.toString(),
                        homeName: this.homeName.toString(),
                        guestName: this.guestName.toString(),
                        homeScore: 0,
                        guestScore: 0,
                        half: '1',
                        time: this.timeMatch.toString(),
                        timeMinutes: this.timeMatch.toString(),
                        timeSeconds: '00',
                        date: new Date(),
                    }).then(function(querySnapshot) {
                        database.collection('matches').doc(querySnapshot.id).collection('scores').doc('score').set({
                            homeOrGuest: 'Home',
                            description: 'Test',
                        }).then(function() {
                            console.log('Match made');
                            window.location.href = 'http://127.0.0.1/includes/activateScoreboard.php' +
                                '?scoreboard=1&scoreboardID=' + querySnapshot.id;
                        });
                    }).catch(function(error) {
                        console.error('Error adding document: ', error);
                    });
                }
            }
        }

        window.customElements.define(MakeMatch.is, MakeMatch);
    </script>
</dom-module>